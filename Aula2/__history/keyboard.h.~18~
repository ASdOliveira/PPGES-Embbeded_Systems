#ifndef __KEYBOARD__
#define __KEYBOARD__

#include <16f877a.h>
#include <typedef.h>

//variáveis auxiliares
uint8_t counter=0;

uint8_t matrixKey[4][4] = {
  {0x07, 0x08, 0x09, 0x0F},
  {0x04, 0x05, 0x06, 0x0E},
  {0x01, 0x02, 0x03, 0x0D},
  {0x0A, 0x00, 0x0B, 0x0C}
};

//prototipos das funcoes
uint8_t decodKey(uint8_t count);

void key_init()
{
 // usar port B, de 0 a 3 como saídas e de 4 a 7 como entradas.
 #use fixed_io (b_outputs = pin_b0,pin_b1,pin_b2,pin_b3)
}

uint8_t key_read()
{
  uint8_t button = 0x00;
  switch(counter)
  {
     case 0: output_b(0x01);
             button = decodKey(counter);
             counter = 1;
     break;
     
     case 1: output_b(0x02);
             button = decodKey(counter);
             counter = 2;
     break;
     
     case 2: output_b(0x04);
             button = decodKey(counter);
             counter = 3;
     break;
     
     case 3: output_b(0x08);
             button = decodKey(counter);
             counter = 0;
     break;
  }
  return button;
}

uint8_t decodKey(uint8_t count)
{
   uint8_t columns = input_b();
   columns = (columns & 0xF0) >> 4;  // descarta os bits menos significativos.
   if(columns != 0x00)  //se algo foi lido...
   {
      return matrixKey[count][columns-1];
   }
   else
   {
      //return 0xFF; // não leu nada...
      return 0;
   }
}




#endif
